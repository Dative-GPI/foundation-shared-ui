import{d as p,e as f,j as T,w as x,H as j,I as H,J as N,K as _,x as D,z as O,M as k,W as z}from"./vue.esm-bundler-9b0e8103.js";import{F as J}from"./FSLoader-1b8a1203.js";import{a as P}from"./base-0de1729e.js";import{S as K}from"./serviceFactory-3393b4e4.js";import{C as X}from"./composableFactory-3da3eea4.js";import{s as c,v as A}from"./css-a20776b9.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Q}from"./VImg-6b167a7c.js";class Z{constructor(t){this.blurHash=t.blurHash,this.width=t.width,this.height=t.height}}const q=()=>`${P()}/images`,ee=()=>`${q()}/raw`,L=e=>`${ee()}/${encodeURIComponent(e)}`,te=(e,t)=>`${L(e)}?access_token=${t}`,ae=()=>`${q()}/blurHash`,re=e=>`${ae()}/${encodeURIComponent(e)}`,le={...K.addCustom("getBlurHash",(e,t)=>e.get(re(t)),e=>new Z(e))},ne=X.custom(le.getBlurHash),M=p(void 0),ie=()=>{const e=a=>{M.value=a},t=f(()=>M.value!==null);return{jwt:M,ready:t,setExtensionJwt:e}};var se=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],g=e=>{let t=0;for(let a=0;a<e.length;a++){let n=e[a],i=se.indexOf(n);t=t*83+i}return t},S=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},F=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},ue=e=>e<0?-1:1,E=(e,t)=>ue(e)*Math.pow(Math.abs(e),t),V=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},U=e=>{if(!e||e.length<6)throw new V("The blurhash string must be at least 6 characters");let t=g(e[0]),a=Math.floor(t/9)+1,n=t%9+1;if(e.length!==4+2*n*a)throw new V(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*n*a}`)},oe=e=>{try{U(e)}catch(t){return{result:!1,errorReason:t.message}}return{result:!0}},de=e=>{let t=e>>16,a=e>>8&255,n=e&255;return[S(t),S(a),S(n)]},he=(e,t)=>{let a=Math.floor(e/361),n=Math.floor(e/19)%19,i=e%19;return[E((a-9)/9,2)*t,E((n-9)/9,2)*t,E((i-9)/9,2)*t]},ce=(e,t,a,n)=>{U(e),n=n|1;let i=g(e[0]),o=Math.floor(i/9)+1,u=i%9+1,I=(g(e[1])+1)/166,m=new Array(u*o);for(let l=0;l<m.length;l++)if(l===0){let s=g(e.substring(2,6));m[l]=de(s)}else{let s=g(e.substring(4+l*2,6+l*2));m[l]=he(s,I*n)}let d=t*4,h=new Uint8ClampedArray(d*a);for(let l=0;l<a;l++)for(let s=0;s<t;s++){let v=0,r=0,R=0;for(let w=0;w<o;w++)for(let y=0;y<u;y++){let B=Math.cos(Math.PI*s*y/t)*Math.cos(Math.PI*l*w/a),$=m[y+w*u];v+=$[0]*B,r+=$[1]*B,R+=$[2]*B}let b=F(v),G=F(r),W=F(R);h[4*s+0+l*d]=b,h[4*s+1+l*d]=G,h[4*s+2+l*d]=W,h[4*s+3+l*d]=255}return h},fe=ce;const C=T({name:"FSImage",components:{FSLoader:J},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:t,entity:a}=ne(),{jwt:n}=ie(),i=p(null),o=p(null),u=p({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),I=f(()=>({"--fs-image-border-radius":c(e.borderRadius),"--fs-image-blurhash-opacity":a.value?"1":"0"})),m=f(()=>{if(e.height)return c(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return c(A(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return c(e.width)}}),d=f(()=>{if(e.width)return c(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return c(A(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return c(e.height)}}),h=f(()=>{if(e.imageB64){if(s.value&&l.value)return`${s.value},${l.value}`}else if(e.imageId)return n.value?te(e.imageId,n.value):L(e.imageId)}),l=f(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),s=f(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in u.value)if(e.imageB64.startsWith(r))return`data:${u.value[r]};base64`}return null}),v=()=>{e.imageId&&t(e.imageId)};return x(()=>a.value,()=>{if(o.value&&i.value&&a.value&&oe(a.value.blurHash).result){const r=o.value.getContext("2d");if(r){const R=fe(a.value.blurHash,i.value.$el.clientWidth,i.value.$el.clientHeight),b=r.createImageData(i.value.$el.clientWidth,i.value.$el.clientHeight);b.data.set(R),r.putImageData(b,0,0)}}}),{computedHeight:m,computedWidth:d,canvasRef:o,imageRef:i,blurHash:a,source:h,style:I,onError:v}}}),me={ref:"canvasRef"};function ge(e,t,a,n,i,o){const u=j("FSLoader");return H(),N(Q,D({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,style:e.style,src:e.source,onError:e.onError},e.$attrs),{placeholder:_(()=>[O(u,{class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])]),error:_(()=>[e.blurHash?k("",!0):(H(),N(u,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),z("canvas",me,null,512)]),_:1},16,["height","width","cover","style","src","onError"])}const $e=Y(C,[["render",ge]]);C.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{$e as F};
