import{a1 as i,d as l}from"./vue.esm-bundler-e580dd1f.js";function v(u,r=t=>!0,n=t=>t.id){return(e,s)=>{switch(e){case"add":b(u,s,n,r);return;case"update":h(u,s,n,r);return;case"delete":g(u,s,n);return}}}function d(u,r=n=>n.id){return(t,e)=>{if(!u.value)return;const s=r(u.value);(t==="add"||t==="update")&&s===r(e)&&(u.value=e),t==="delete"&&s===e&&(u.value=null)}}function b(u,r,n,t){const e=u.value,s=n(r),a=e.findIndex(o=>n(o)===s),c=t(r);a==-1&&c?e.push(r):a==-1&&!c||(a!=-1&&!c?e.splice(a,1):e.splice(a,1,r))}function h(u,r,n,t){const e=u.value,s=n(r),a=e.findIndex(o=>n(o)===s),c=t(r);a!=-1&&c?e.splice(a,1,r):a!=-1&&!c?e.splice(a,1):a==-1&&c&&e.push(r)}function g(u,r,n){const t=u.value,e=t.findIndex(s=>n(s)===r);e!=-1&&t.splice(e,1)}class p{static create(r){return t=>{for(const e in r)if(t[e]!==r[e])return!1;return!0}}}class I{static get(r){return()=>{const n=r();let t=[];i(()=>{t.forEach(c=>n.unsubscribe(c)),t=[]});const e=l(!1),s=l(null);return{getting:e,get:async c=>{e.value=!0;try{s.value=await n.get(c)}finally{e.value=!1}return t.push(n.subscribe("all",d(s))),s},entity:s}}}static getMany(r){return()=>{const n=r();let t=[];i(()=>{t.forEach(c=>n.unsubscribe(c)),t=[]});const e=l(!1),s=l([]);return{fetching:e,getMany:async(c,o)=>{e.value=!0;try{s.value=await n.getMany(c)}finally{e.value=!1}const f=o||(c?p.create(c):y=>!0);return t.push(n.subscribe("all",v(s,f))),s},entities:s}}}static create(r){return()=>{const n=r();let t=[];i(()=>{t.forEach(c=>n.unsubscribe(c)),t=[]});const e=l(!1),s=l(null);return{creating:e,create:async c=>{e.value=!0;try{s.value=await n.create(c)}finally{e.value=!1}return t.push(n.subscribe("all",d(s))),s},created:s}}}static update(r){return()=>{const n=r();let t=[];i(()=>{t.forEach(c=>n.unsubscribe(c)),t=[]});const e=l(!1),s=l(null);return{updating:e,update:async(c,o)=>{e.value=!0;try{s.value=await n.update(c,o)}finally{e.value=!1}return t.push(n.subscribe("all",d(s))),s.value},updated:s}}}static remove(r){return()=>{const n=r(),t=l(!1);return{removing:t,remove:async s=>{t.value=!0;try{await n.remove(s)}finally{t.value=!1}}}}}}export{I as C};
