import{W as f,b as i}from"./vue.esm-bundler-Zcuj-zyO.js";function p(l,t=c=>!0,s=c=>c.id){return(e,u)=>{switch(e){case"add":g(l,u,s,t);return;case"update":I(l,u,s,t);return;case"delete":M(l,u,s);return}}}function d(l,t,s=c=>c.id){return(e,u)=>{if(!l.value)return;const n=s(l.value);(e==="add"||e==="update")&&n===s(u)&&(l.value=u,t&&t(l)),e==="delete"&&n===u&&(l.value=null)}}function g(l,t,s,c){const e=l.value,u=s(t),n=e.findIndex(o=>s(o)===u),r=c(t);n==-1&&r?e.push(t):n==-1&&!r||(n!=-1&&!r?e.splice(n,1):e.splice(n,1,t))}function I(l,t,s,c){const e=l.value,u=s(t),n=e.findIndex(o=>s(o)===u),r=c(t);n!=-1&&r?e.splice(n,1,t):n!=-1&&!r?e.splice(n,1):n==-1&&r&&e.push(t)}function M(l,t,s){const c=l.value,e=c.findIndex(u=>s(u)===t);e!=-1&&c.splice(e,1)}class v{static create(t){return c=>{for(const e in t)if(c[e]!==t[e])return!1;return!0}}}class b{static get(t,s){return b.customGet(t,t.get,s)}static getMany(t,s){return b.customGetMany(t,t.getMany,s)}static create(t,s){return b.customCreate(t,t.create,s)}static update(t,s){return b.customUpdate(t,t.update,s)}static remove(t){return b.customRemove(t.remove)}static subscribe(t){return()=>{let s=[];return f(()=>{s.forEach(e=>t.unsubscribe(e)),s=[]}),{subscribe:(e,u)=>{const n=t.subscribe(e,u);return s.push(n),n}}}}static custom(t,s){return()=>{const c=s?s():()=>{},e=i(!1),u=i(null);return{fetching:e,fetch:async(...r)=>{e.value=!0;try{u.value=await t(...r),c&&c(u)}finally{e.value=!1}return u},entity:u}}}static customGet(t,s,c){return()=>{const e=c?c():()=>{};let u=[];f(()=>{u.forEach(a=>t.unsubscribe(a)),u=[]});const n=i(!1),r=i(null);return{getting:n,get:async(...a)=>{n.value=!0;try{r.value=await s(...a),e&&e(r)}finally{n.value=!1}return u.push(t.subscribe("all",d(r,e))),r},entity:r}}}static customGetMany(t,s,c){return()=>{const e=c?c():()=>{};let u=[];f(()=>{u.forEach(a=>t.unsubscribe(a)),u=[]});const n=i(!1),r=i([]);return{fetching:n,getMany:async(...a)=>{n.value=!0;let y;a.length>1&&typeof a[a.length-1]=="function"&&(y=a.pop());let h=a;try{r.value=await s(...h),e&&e(r)}finally{n.value=!1}const m=y||(h.length>0?v.create(h[0]):()=>!0);return u.push(t.subscribe("all",p(r,m))),u.push(t.subscribe("reset",async()=>{n.value=!0;try{r.value=await s(...h),e&&e(r)}finally{n.value=!1}})),r},entities:r}}}static customCreate(t,s,c){return()=>{const e=c?c():()=>{};let u=[];f(()=>{u.forEach(a=>t.unsubscribe(a)),u=[]});const n=i(!1),r=i(null);return{creating:n,create:async(...a)=>{n.value=!0;try{r.value=await s(...a),e&&e(r)}finally{n.value=!1}return u.push(t.subscribe("all",d(r))),r},created:r}}}static customUpdate(t,s,c){return()=>{const e=c?c():()=>{};let u=[];f(()=>{u.forEach(a=>t.unsubscribe(a)),u=[]});const n=i(!1),r=i(null);return{updating:n,update:async(...a)=>{n.value=!0;try{r.value=await s(...a),e&&e(r)}finally{n.value=!1}return u.push(t.subscribe("all",d(r))),r.value},updated:r}}}static customRemove(t){return()=>{const s=i(!1);return{removing:s,remove:async(...e)=>{s.value=!0;try{await t(...e)}finally{s.value=!1}}}}}static sync(t){return()=>{let s=[];return f(()=>{s.forEach(e=>t.unsubscribe(e)),s=[]}),{sync:(e,u,n)=>{const r=i(e),o=n||(u?v.create(u):a=>!0);return s.push(t.subscribe("all",p(r,o))),r}}}}static syncRef(t){return()=>{let s=[];return f(()=>{s.forEach(e=>t.unsubscribe(e)),s=[]}),{sync:(e,u,n)=>{const r=n||(u?v.create(u):o=>!0);return s.push(t.subscribe("all",p(e,r))),e}}}}static track(t){return()=>{let s=[];return f(()=>{s.forEach(e=>t.unsubscribe(e)),s=[]}),{track:(e,u)=>{const n=i(e);return s.push(t.subscribe("all",d(n,r=>u?u(r.value):null))),n}}}}static trackRef(t){return()=>{let s=[];return f(()=>{s.forEach(e=>t.unsubscribe(e)),s=[]}),{track:(e,u)=>(s.push(t.subscribe("all",d(e,u))),e)}}}}export{b as C,p as o};
