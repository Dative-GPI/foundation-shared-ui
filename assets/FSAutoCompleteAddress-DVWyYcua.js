import{d as P,b as S,o as b,w as v,y as k,z as I,A as U,m as O}from"./vue.esm-bundler-DeSao-KJ.js";import{_ as w}from"./lodash-BiW_TGGX.js";import{A as V}from"./address-CE2z3AEI.js";import{F as T}from"./FSAutocompleteField-Bkpq8AAI.js";import{u as $}from"./useAutocomplete-CRHnexwL.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B=()=>{let s=!1,r,p,c;const l=async()=>{await window.initMap,r=new google.maps.places.AutocompleteService,p=new google.maps.places.PlacesService(document.getElementById("places")),c=new google.maps.places.AutocompleteSessionToken,s=!0},m=async e=>(s||await l(),g(e).then(o=>w.map(o,t=>({id:t.place_id,label:t.description}))).catch(()=>[])),u=async e=>{var t,a;s||await l();const o=await y(e.id);if(c=new google.maps.places.AutocompleteSessionToken,o.address_components&&o.formatted_address&&o.geometry)return new V({formattedAddress:o.formatted_address,locality:i(o.address_components,"locality"),country:i(o.address_components,"country"),latitude:((t=o.geometry.location)==null?void 0:t.lat())??0,longitude:((a=o.geometry.location)==null?void 0:a.lng())??0,placeId:e.id,placeLabel:e.label});throw new Error("missing informations")},f=async(e,o)=>(s||await l(),new Promise((t,a)=>{new google.maps.Geocoder().geocode({location:{lat:e,lng:o}},(n,A)=>{var _,h;if(A!=google.maps.GeocoderStatus.OK||!n)console.error(A),a(A);else{const d=n[0];d.address_components&&d.formatted_address&&d.geometry?t(new V({formattedAddress:d.formatted_address,locality:i(d.address_components,"locality"),country:i(d.address_components,"country"),latitude:((_=d.geometry.location)==null?void 0:_.lat())??0,longitude:((h=d.geometry.location)==null?void 0:h.lng())??0,placeId:"",placeLabel:""})):(console.error("missing informations"),a("missing informations"))}})})),g=e=>new Promise((o,t)=>{r.getPlacePredictions({input:e,sessionToken:c},function(a,n){n!=google.maps.places.PlacesServiceStatus.OK||!a?t(n):o(a)})}),y=e=>new Promise((o,t)=>{p.getDetails({placeId:e,sessionToken:c,fields:["formatted_address","geometry","address_components","name"]},(a,n)=>{n!=google.maps.places.PlacesServiceStatus.OK||!a?t(n):o(a)})}),i=(e,o)=>{const t=w.find(e,a=>w.some(a.types,n=>n===o));return(t==null?void 0:t.long_name)??""};return{search:m,get:u,reverseSearch:f}},F=P({name:"FSAutocompleteAddress",components:{FSAutocompleteField:T},props:{modelValue:{type:Object,required:!1,default:null}},emits:["update:modelValue"],setup(s,{emit:r}){const{search:p,get:c}=B(),l=S([]),m=S(null),u=async e=>e===null?Promise.resolve([]):(l.value=await p(e),Promise.resolve([])),f=async e=>{if(e===null){r("update:modelValue",null);return}Array.isArray(e)&&(e=e[0]);const o=await c(e);r("update:modelValue",o)},{search:g,onUpdate:y}=$(l,[],r,u,f,e=>e.id,e=>e.label,!0,!1),i=e=>({id:e.placeId,label:e.placeLabel===""?e.formattedAddress:e.placeLabel});return b(()=>{s.modelValue&&(m.value=i(s.modelValue))}),v(()=>s.modelValue,e=>{e&&(m.value=i(e))}),{modelValuePlace:m,places:l,search:g,onUpdate:y}}});function C(s,r,p,c,l,m){const u=k("FSAutocompleteField");return I(),U(u,O({clearable:!1,toggleSet:!1,multiple:!1,items:s.places,modelValue:s.modelValuePlace,"onUpdate:modelValue":s.onUpdate,search:s.search,"onUpdate:search":r[0]||(r[0]=f=>s.search=f)},s.$attrs),null,16,["items","modelValue","onUpdate:modelValue","search"])}const N=L(F,[["render",C]]);F.__docgenInfo={displayName:"FSAutocompleteAddress",exportName:"default",description:"",tags:{},props:[{name:"modelValue",type:{name:"Object as () => Address | null"},required:!1,defaultValue:{func:!1,value:"null"}}],events:[{name:"update:modelValue"}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/autocompletes/FSAutoCompleteAddress.vue"]};export{N as F,B as u};
