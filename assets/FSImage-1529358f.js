import{j as I,g as c,f as D,w as j,D as k,E as M,F as E,G as q,A as O,I as V,_ as x}from"./vue.esm-bundler-6f923154.js";import{F as P}from"./FSLoader-6b86cc0d.js";import{a as z}from"./base-0de1729e.js";import{S as J}from"./serviceFactory-2dfad3af.js";import{C as X}from"./composableFactory-85dd6557.js";import{s as f,v as L}from"./css-0cf2e273.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Y}from"./VImg-8e65ad17.js";class Q{constructor(t){this.blurHash=t.blurHash,this.width=t.width,this.height=t.height}}const C=()=>`${z()}/images`,Z=()=>`${C()}/raw`,G=e=>`${Z()}/${encodeURIComponent(e)}`,ee=(e,t)=>`${G(e)}?access_token=${t}`,te=()=>`${C()}/blurHash`,ae=e=>`${te()}/${encodeURIComponent(e)}`,re={...J.addCustom("getBlurHash",(e,t)=>e.get(ae(t)),e=>new Q(e))},le=X.custom(re.getBlurHash),_=I(void 0),ne=()=>{const e=a=>{_.value=a},t=c(()=>_.value!==null);return{jwt:_,ready:t,setExtensionJwt:e}};var ie=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],R=e=>{let t=0;for(let a=0;a<e.length;a++){let n=e[a],s=ie.indexOf(n);t=t*83+s}return t},N=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},H=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},se=e=>e<0?-1:1,A=(e,t)=>se(e)*Math.pow(Math.abs(e),t),U=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},T=e=>{if(!e||e.length<6)throw new U("The blurhash string must be at least 6 characters");let t=R(e[0]),a=Math.floor(t/9)+1,n=t%9+1;if(e.length!==4+2*n*a)throw new U(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*n*a}`)},ue=e=>{try{T(e)}catch(t){return{result:!1,errorReason:t.message}}return{result:!0}},oe=e=>{let t=e>>16,a=e>>8&255,n=e&255;return[N(t),N(a),N(n)]},de=(e,t)=>{let a=Math.floor(e/361),n=Math.floor(e/19)%19,s=e%19;return[A((a-9)/9,2)*t,A((n-9)/9,2)*t,A((s-9)/9,2)*t]},he=(e,t,a,n)=>{T(e),n=n|1;let s=R(e[0]),u=Math.floor(s/9)+1,o=s%9+1,S=(R(e[1])+1)/166,m=new Array(o*u);for(let l=0;l<m.length;l++)if(l===0){let i=R(e.substring(2,6));m[l]=oe(i)}else{let i=R(e.substring(4+l*2,6+l*2));m[l]=de(i,S*n)}let d=t*4,h=new Uint8ClampedArray(d*a);for(let l=0;l<a;l++)for(let i=0;i<t;i++){let b=0,r=0,g=0;for(let w=0;w<u;w++)for(let p=0;p<o;p++){let $=Math.cos(Math.PI*i*p/t)*Math.cos(Math.PI*l*w/a),F=m[p+w*o];b+=F[0]*$,r+=F[1]*$,g+=F[2]*$}let v=H(b),B=H(r),y=H(g);h[4*i+0+l*d]=v,h[4*i+1+l*d]=B,h[4*i+2+l*d]=y,h[4*i+3+l*d]=255}return h},fe=he;const W=D({name:"FSImage",components:{FSLoader:P},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},source:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:t,entity:a}=le(),{jwt:n}=ne(),s=I(null),u=I(null),o=I({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),S=c(()=>({"--fs-image-border-radius":f(e.borderRadius),"--fs-image-blurhash-opacity":a.value?"1":"0"})),m=c(()=>{if(e.height)return f(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(L(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return f(e.width)}}),d=c(()=>{if(e.width)return f(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(L(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return f(e.height)}}),h=c(()=>{if(e.imageB64){if(i.value&&l.value)return`${i.value},${l.value}`}else if(e.imageId)return n.value?ee(e.imageId,n.value):G(e.imageId);return e.source}),l=c(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),i=c(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in o.value)if(e.imageB64.startsWith(r))return`data:${o.value[r]};base64`}return null}),b=()=>{e.imageId&&t(e.imageId)};return j(()=>a.value,()=>{if(u.value&&s.value&&a.value&&ue(a.value.blurHash).result){const r=u.value.getContext("2d");if(r){const g=s.value.$el.clientWidth,v=s.value.$el.clientHeight,B=fe(a.value.blurHash,g,v),y=r.createImageData(g,v);u.value.width=g,u.value.height=v,y.data.set(B),r.putImageData(y,0,0)}}}),{computedHeight:m,computedWidth:d,realSource:h,canvasRef:u,imageRef:s,blurHash:a,style:S,onError:b}}}),ce={ref:"canvasRef"};function me(e,t,a,n,s,u){const o=k("FSLoader");return M(),E(Y,O({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,src:e.realSource,style:e.style,onError:e.onError},e.$attrs),{placeholder:q(()=>[e.$props.imageId?(M(),E(o,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])):V("",!0)]),error:q(()=>[e.blurHash?V("",!0):(M(),E(o,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),x("canvas",ce,null,512)]),_:1},16,["height","width","cover","src","style","onError"])}const Se=K(W,[["render",me]]);W.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"source",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{Se as F};
