var z=Object.defineProperty;var P=(e,a,t)=>a in e?z(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t;var I=(e,a,t)=>P(e,typeof a!="symbol"?a+"":a,t);import{d as A,b as B,c as f,w as x,y as E,z as R,A as w,B as V,m as C,D as _,W as J}from"./vue.esm-bundler-DC82FEWN.js";import{F as K}from"./FSLoader-BCzmDe0l.js";import{s as h,v as N}from"./css-DYOPUjjE.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Y}from"./VImg-DgHq50DD.js";import{G as Q}from"./base-CmdGny12.js";import{C as X}from"./composableFactory-J8cSLWf9.js";import{S as Z}from"./serviceFactory-Bd5jifNi.js";class ee{constructor(a){I(this,"blurHash");I(this,"width");I(this,"height");this.blurHash=a.blurHash,this.width=a.width,this.height=a.height}}const G=()=>`${Q()}/images`,ae=()=>`${G()}/raw`,te=e=>`${ae()}/${encodeURIComponent(e)}`,re=()=>`${G()}/blurHash`,le=e=>`${re()}/${encodeURIComponent(e)}`,ne={...Z.addCustom("getBlurHash",(e,a)=>e.get(le(a)),e=>new ee(e))},se=X.custom(ne.getBlurHash);var ue=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],g=e=>{let a=0;for(let t=0;t<e.length;t++){let l=e[t],u=ue.indexOf(l);a=a*83+u}return a},F=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},H=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},ie=e=>e<0?-1:1,M=(e,a)=>ie(e)*Math.pow(Math.abs(e),a),U=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},W=e=>{if(!e||e.length<6)throw new U("The blurhash string must be at least 6 characters");let a=g(e[0]),t=Math.floor(a/9)+1,l=a%9+1;if(e.length!==4+2*l*t)throw new U(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*l*t}`)},oe=e=>{try{W(e)}catch(a){return{result:!1,errorReason:a.message}}return{result:!0}},de=e=>{let a=e>>16,t=e>>8&255,l=e&255;return[F(a),F(t),F(l)]},he=(e,a)=>{let t=Math.floor(e/361),l=Math.floor(e/19)%19,u=e%19;return[M((t-9)/9,2)*a,M((l-9)/9,2)*a,M((u-9)/9,2)*a]},fe=(e,a,t,l)=>{W(e),l=l|1;let u=g(e[0]),m=Math.floor(u/9)+1,i=u%9+1,b=(g(e[1])+1)/166,d=new Array(i*m);for(let n=0;n<d.length;n++)if(n===0){let s=g(e.substring(2,6));d[n]=de(s)}else{let s=g(e.substring(4+n*2,6+n*2));d[n]=he(s,b*l)}let o=a*4,r=new Uint8ClampedArray(o*t);for(let n=0;n<t;n++)for(let s=0;s<a;s++){let p=0,c=0,q=0;for(let v=0;v<m;v++)for(let y=0;y<i;y++){let $=Math.cos(Math.PI*s*y/a)*Math.cos(Math.PI*n*v/t),S=d[y+v*i];p+=S[0]*$,c+=S[1]*$,q+=S[2]*$}let T=H(p),O=H(c),j=H(q);r[4*s+0+n*o]=T,r[4*s+1+n*o]=O,r[4*s+2+n*o]=j,r[4*s+3+n*o]=255}return r},me=fe;const D=A({name:"FSImageUI",components:{FSLoader:K},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageB64:{type:String,required:!1,default:null},source:{type:String,required:!1,default:null},blurHash:{type:Object,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0},loading:{type:Boolean,required:!1,default:!1}},setup(e){const a=B(null),t=B(null),l=B({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),u=f(()=>({"--fs-image-border-radius":h(e.borderRadius),"--fs-image-blurhash-opacity":e.blurHash?"1":"0"})),m=f(()=>{if(e.height)return h(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return h(N(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return h(e.width)}}),i=f(()=>{if(e.width)return h(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return h(N(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return h(e.height)}}),b=f(()=>{if(e.imageB64){if(o.value&&d.value)return`${o.value},${d.value}`}else if(e.source)return e.source}),d=f(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),o=f(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in l.value)if(e.imageB64.startsWith(r))return`data:${l.value[r]};base64`}return null});return x(()=>e.blurHash,()=>{if(t.value&&a.value&&e.blurHash&&oe(e.blurHash.blurHash).result){const r=t.value.getContext("2d");if(r){const n=a.value.$el.clientWidth,s=a.value.$el.clientHeight,p=me(e.blurHash.blurHash,n,s),c=r.createImageData(n,s);t.value.width=n,t.value.height=s,c.data.set(p),r.putImageData(c,0,0)}}}),{computedHeight:m,computedWidth:i,realSource:b,canvasRef:t,imageRef:a,style:u}}}),ce={ref:"canvasRef"};function ge(e,a,t,l,u,m){const i=E("FSLoader");return R(),w(Y,C({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,src:e.realSource,style:e.style,onError:a[0]||(a[0]=b=>e.$emit("error"))},e.$attrs),{placeholder:V(()=>[e.$props.loading?(R(),w(i,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])):_("",!0)]),error:V(()=>[e.$props.blurHash?_("",!0):(R(),w(i,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),J("canvas",ce,null,512)]),_:1},16,["height","width","cover","src","style"])}const be=L(D,[["render",ge]]);D.__docgenInfo={displayName:"FSImageUI",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"source",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"blurHash",type:{name:"BlurHash | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}},{name:"loading",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"false"}}],events:[{name:"error"}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImageUI.vue"]};const k=A({name:"FSImage",components:{FSImageUI:be},props:{imageId:{type:String,required:!1,default:null}},setup(e){const{fetch:a,entity:t}=se(),l=f(()=>e.imageId?te(e.imageId):null);return{blurHash:t,source:l,onError:()=>{e.imageId&&a(e.imageId)}}}});function pe(e,a,t,l,u,m){const i=E("FSImageUI");return R(),w(i,C({blurhash:e.blurHash,source:e.source,onError:e.onError},e.$attrs),null,16,["blurhash","source","onError"])}const He=L(k,[["render",pe]]);k.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{He as F};
