import{j as x,d as M,e as c,w as N,H as O,I as V,J as _,K as E,x as j,z as k,M as z,W as P}from"./vue.esm-bundler-9b0e8103.js";import{F as J}from"./FSLoader-57df4c1d.js";import{a as K}from"./base-0de1729e.js";import{S as q}from"./serviceFactory-3393b4e4.js";import{C as L}from"./composableFactory-3da3eea4.js";import{s as m,v as A}from"./css-a20776b9.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Y}from"./VImg-6b167a7c.js";class Q{constructor(a){this.blurHash=a.blurHash,this.width=a.width,this.height=a.height}}const U=()=>`${K()}/images`,Z=()=>`${U()}/raw`,ee=e=>`${Z()}/${encodeURIComponent(e)}`,ae=()=>`${U()}/blurHash`,te=e=>`${ae()}/${encodeURIComponent(e)}`,G={...q.addCustom("getRaw",(e,a)=>e.get(ee(a)),e=>e),...q.addCustom("getBlurHash",(e,a)=>e.get(te(a)),e=>new Q(e))},re=L.custom(G.getRaw),ie=L.custom(G.getBlurHash);var le=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],v=e=>{let a=0;for(let t=0;t<e.length;t++){let l=e[t],s=le.indexOf(l);a=a*83+s}return a},S=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},F=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},ne=e=>e<0?-1:1,H=(e,a)=>ne(e)*Math.pow(Math.abs(e),a),C=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},W=e=>{if(!e||e.length<6)throw new C("The blurhash string must be at least 6 characters");let a=v(e[0]),t=Math.floor(a/9)+1,l=a%9+1;if(e.length!==4+2*l*t)throw new C(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*l*t}`)},se=e=>{try{W(e)}catch(a){return{result:!1,errorReason:a.message}}return{result:!0}},ue=e=>{let a=e>>16,t=e>>8&255,l=e&255;return[S(a),S(t),S(l)]},oe=(e,a)=>{let t=Math.floor(e/361),l=Math.floor(e/19)%19,s=e%19;return[H((t-9)/9,2)*a,H((l-9)/9,2)*a,H((s-9)/9,2)*a]},de=(e,a,t,l)=>{W(e),l=l|1;let s=v(e[0]),u=Math.floor(s/9)+1,o=s%9+1,R=(v(e[1])+1)/166,f=new Array(o*u);for(let i=0;i<f.length;i++)if(i===0){let n=v(e.substring(2,6));f[i]=ue(n)}else{let n=v(e.substring(4+i*2,6+i*2));f[i]=oe(n,R*l)}let d=a*4,h=new Uint8ClampedArray(d*t);for(let i=0;i<t;i++)for(let n=0;n<a;n++){let g=0,b=0,r=0;for(let y=0;y<u;y++)for(let I=0;I<o;I++){let B=Math.cos(Math.PI*n*I/a)*Math.cos(Math.PI*i*y/t),$=f[I+y*o];g+=$[0]*B,b+=$[1]*B,r+=$[2]*B}let p=F(g),w=F(b),D=F(r);h[4*n+0+i*d]=p,h[4*n+1+i*d]=w,h[4*n+2+i*d]=D,h[4*n+3+i*d]=255}return h},he=de;const T=x({name:"FSImage",components:{FSLoader:J},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:a,entity:t}=ie(),{fetch:l,entity:s}=re(),u=M(null),o=M(null),R=M({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),f=c(()=>({"--fs-image-border-radius":m(e.borderRadius),"--fs-image-blurhash-opacity":t.value?"1":"0"})),d=c(()=>{if(e.height)return m(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return m(A(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return m(e.width)}}),h=c(()=>{if(e.width)return m(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return m(A(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return m(e.height)}}),i=c(()=>{if(e.imageB64&&g.value&&n.value)return`${g.value},${n.value}`;if(e.imageId&&s.value)return s.value}),n=c(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),g=c(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in R.value)if(e.imageB64.startsWith(r))return`data:${R.value[r]};base64`}return null}),b=()=>{e.imageId&&a(e.imageId)};return N(()=>e.imageId,()=>{e.imageId&&l(e.imageId)},{immediate:!0}),N(()=>t.value,()=>{if(o.value&&u.value&&t.value&&se(t.value.blurHash).result){const r=o.value.getContext("2d");if(r){const p=he(t.value.blurHash,u.value.$el.clientWidth,u.value.$el.clientHeight),w=r.createImageData(u.value.$el.clientWidth,u.value.$el.clientHeight);w.data.set(p),r.putImageData(w,0,0)}}}),{computedHeight:d,computedWidth:h,canvasRef:o,imageRef:u,blurHash:t,source:i,style:f,onError:b}}}),me={ref:"canvasRef"};function fe(e,a,t,l,s,u){const o=O("FSLoader");return V(),_(Y,j({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,style:e.style,src:e.source,onError:e.onError},e.$attrs),{placeholder:E(()=>[k(o,{class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])]),error:E(()=>[e.blurHash?z("",!0):(V(),_(o,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),P("canvas",me,null,512)]),_:1},16,["height","width","cover","style","src","onError"])}const pe=X(T,[["render",fe]]);T.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{pe as F};
