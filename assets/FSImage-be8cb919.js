import{d as w,e as c,j,w as k,I as D,J as S,K as M,L as _,A as O,N as A,$ as x}from"./vue.esm-bundler-82a4b45a.js";import{F as J}from"./FSLoader-5be1941d.js";import{a as P}from"./base-0de1729e.js";import{S as z}from"./serviceFactory-7552fe10.js";import{C as K}from"./composableFactory-2f513de5.js";import{s as f,v as V}from"./css-c39c4a6e.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Y}from"./VImg-a45e529b.js";class Q{constructor(t){this.blurHash=t.blurHash,this.width=t.width,this.height=t.height}}const L=()=>`${P()}/images`,Z=()=>`${L()}/raw`,U=e=>`${Z()}/${encodeURIComponent(e)}`,ee=(e,t)=>`${U(e)}?access_token=${t}`,te=()=>`${L()}/blurHash`,ae=e=>`${te()}/${encodeURIComponent(e)}`,re={...z.addCustom("getBlurHash",(e,t)=>e.get(ae(t)),e=>new Q(e))},le=K.custom(re.getBlurHash),F=w(void 0),ne=()=>{const e=a=>{F.value=a},t=c(()=>F.value!==null);return{jwt:F,ready:t,setExtensionJwt:e}};var ie=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],g=e=>{let t=0;for(let a=0;a<e.length;a++){let n=e[a],i=ie.indexOf(n);t=t*83+i}return t},E=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},N=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},se=e=>e<0?-1:1,H=(e,t)=>se(e)*Math.pow(Math.abs(e),t),q=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},C=e=>{if(!e||e.length<6)throw new q("The blurhash string must be at least 6 characters");let t=g(e[0]),a=Math.floor(t/9)+1,n=t%9+1;if(e.length!==4+2*n*a)throw new q(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*n*a}`)},ue=e=>{try{C(e)}catch(t){return{result:!1,errorReason:t.message}}return{result:!0}},oe=e=>{let t=e>>16,a=e>>8&255,n=e&255;return[E(t),E(a),E(n)]},de=(e,t)=>{let a=Math.floor(e/361),n=Math.floor(e/19)%19,i=e%19;return[H((a-9)/9,2)*t,H((n-9)/9,2)*t,H((i-9)/9,2)*t]},he=(e,t,a,n)=>{C(e),n=n|1;let i=g(e[0]),o=Math.floor(i/9)+1,u=i%9+1,I=(g(e[1])+1)/166,m=new Array(u*o);for(let l=0;l<m.length;l++)if(l===0){let s=g(e.substring(2,6));m[l]=oe(s)}else{let s=g(e.substring(4+l*2,6+l*2));m[l]=de(s,I*n)}let d=t*4,h=new Uint8ClampedArray(d*a);for(let l=0;l<a;l++)for(let s=0;s<t;s++){let v=0,r=0,R=0;for(let y=0;y<o;y++)for(let p=0;p<u;p++){let $=Math.cos(Math.PI*s*p/t)*Math.cos(Math.PI*l*y/a),B=m[p+y*u];v+=B[0]*$,r+=B[1]*$,R+=B[2]*$}let b=N(v),W=N(r),T=N(R);h[4*s+0+l*d]=b,h[4*s+1+l*d]=W,h[4*s+2+l*d]=T,h[4*s+3+l*d]=255}return h},fe=he;const G=j({name:"FSImage",components:{FSLoader:J},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:t,entity:a}=le(),{jwt:n}=ne(),i=w(null),o=w(null),u=w({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),I=c(()=>({"--fs-image-border-radius":f(e.borderRadius),"--fs-image-blurhash-opacity":a.value?"1":"0"})),m=c(()=>{if(e.height)return f(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(V(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return f(e.width)}}),d=c(()=>{if(e.width)return f(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(V(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return f(e.height)}}),h=c(()=>{if(e.imageB64){if(s.value&&l.value)return`${s.value},${l.value}`}else if(e.imageId)return n.value?ee(e.imageId,n.value):U(e.imageId)}),l=c(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),s=c(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in u.value)if(e.imageB64.startsWith(r))return`data:${u.value[r]};base64`}return null}),v=()=>{e.imageId&&t(e.imageId)};return k(()=>a.value,()=>{if(o.value&&i.value&&a.value&&ue(a.value.blurHash).result){const r=o.value.getContext("2d");if(r){const R=fe(a.value.blurHash,i.value.$el.clientWidth,i.value.$el.clientHeight),b=r.createImageData(i.value.$el.clientWidth,i.value.$el.clientHeight);b.data.set(R),r.putImageData(b,0,0)}}}),{computedHeight:m,computedWidth:d,canvasRef:o,imageRef:i,blurHash:a,source:h,style:I,onError:v}}}),ce={ref:"canvasRef"};function me(e,t,a,n,i,o){const u=D("FSLoader");return S(),M(Y,O({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,style:e.style,src:e.source,onError:e.onError},e.$attrs),{placeholder:_(()=>[e.$props.imageId?(S(),M(u,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])):A("",!0)]),error:_(()=>[e.blurHash?A("",!0):(S(),M(u,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),x("canvas",ce,null,512)]),_:1},16,["height","width","cover","style","src","onError"])}const $e=X(G,[["render",me]]);G.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{$e as F};
