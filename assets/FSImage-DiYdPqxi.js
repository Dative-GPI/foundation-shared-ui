var k=Object.defineProperty;var O=(e,t,a)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var I=(e,t,a)=>O(e,typeof t!="symbol"?t+"":t,a);import{b as B,c,d as j,w as x,y as z,z as E,A as H,B as V,m as P,D as L,W as J}from"./vue.esm-bundler-DC82FEWN.js";import{F as X}from"./FSLoader-B1rWpyEr.js";import{a as K}from"./base-BNnJ_ndD.js";import{C as Y}from"./composableFactory-J8cSLWf9.js";import{S as Q}from"./serviceFactory-Bd5jifNi.js";import{s as f,v as U}from"./css-DYOPUjjE.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ee}from"./VImg-D_T7DUU3.js";class te{constructor(t){I(this,"blurHash");I(this,"width");I(this,"height");this.blurHash=t.blurHash,this.width=t.width,this.height=t.height}}const G=()=>`${K()}/images`,ae=()=>`${G()}/raw`,W=e=>`${ae()}/${encodeURIComponent(e)}`,re=(e,t)=>`${W(e)}?access_token=${t}`,le=()=>`${G()}/blurHash`,ne=e=>`${le()}/${encodeURIComponent(e)}`,ie={...Q.addCustom("getBlurHash",(e,t)=>e.get(ne(t)),e=>new te(e))},se=Y.custom(ie.getBlurHash),N=B(void 0),ue=()=>{const e=a=>{N.value=a},t=c(()=>N.value!==null);return{jwt:N,ready:t,setExtensionJwt:e}};var oe=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],b=e=>{let t=0;for(let a=0;a<e.length;a++){let n=e[a],s=oe.indexOf(n);t=t*83+s}return t},_=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},A=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},de=e=>e<0?-1:1,q=(e,t)=>de(e)*Math.pow(Math.abs(e),t),C=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},T=e=>{if(!e||e.length<6)throw new C("The blurhash string must be at least 6 characters");let t=b(e[0]),a=Math.floor(t/9)+1,n=t%9+1;if(e.length!==4+2*n*a)throw new C(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*n*a}`)},he=e=>{try{T(e)}catch(t){return{result:!1,errorReason:t.message}}return{result:!0}},fe=e=>{let t=e>>16,a=e>>8&255,n=e&255;return[_(t),_(a),_(n)]},ce=(e,t)=>{let a=Math.floor(e/361),n=Math.floor(e/19)%19,s=e%19;return[q((a-9)/9,2)*t,q((n-9)/9,2)*t,q((s-9)/9,2)*t]},me=(e,t,a,n)=>{T(e),n=n|1;let s=b(e[0]),u=Math.floor(s/9)+1,o=s%9+1,S=(b(e[1])+1)/166,m=new Array(o*u);for(let l=0;l<m.length;l++)if(l===0){let i=b(e.substring(2,6));m[l]=fe(i)}else{let i=b(e.substring(4+l*2,6+l*2));m[l]=ce(i,S*n)}let d=t*4,h=new Uint8ClampedArray(d*a);for(let l=0;l<a;l++)for(let i=0;i<t;i++){let y=0,r=0,g=0;for(let w=0;w<u;w++)for(let p=0;p<o;p++){let M=Math.cos(Math.PI*i*p/t)*Math.cos(Math.PI*l*w/a),F=m[p+w*o];y+=F[0]*M,r+=F[1]*M,g+=F[2]*M}let v=A(y),$=A(r),R=A(g);h[4*i+0+l*d]=v,h[4*i+1+l*d]=$,h[4*i+2+l*d]=R,h[4*i+3+l*d]=255}return h},ge=me;const D=j({name:"FSImage",components:{FSLoader:X},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},source:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:t,entity:a}=se(),{jwt:n}=ue(),s=B(null),u=B(null),o=B({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),S=c(()=>({"--fs-image-border-radius":f(e.borderRadius),"--fs-image-blurhash-opacity":a.value?"1":"0"})),m=c(()=>{if(e.height)return f(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(U(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return f(e.width)}}),d=c(()=>{if(e.width)return f(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return f(U(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return f(e.height)}}),h=c(()=>{if(e.imageB64){if(i.value&&l.value)return`${i.value},${l.value}`}else if(e.imageId)return n.value?re(e.imageId,n.value):W(e.imageId);return e.source}),l=c(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),i=c(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in o.value)if(e.imageB64.startsWith(r))return`data:${o.value[r]};base64`}return null}),y=()=>{e.imageId&&t(e.imageId)};return x(()=>a.value,()=>{if(u.value&&s.value&&a.value&&he(a.value.blurHash).result){const r=u.value.getContext("2d");if(r){const g=s.value.$el.clientWidth,v=s.value.$el.clientHeight,$=ge(a.value.blurHash,g,v),R=r.createImageData(g,v);u.value.width=g,u.value.height=v,R.data.set($),r.putImageData(R,0,0)}}}),{computedHeight:m,computedWidth:d,realSource:h,canvasRef:u,imageRef:s,blurHash:a,style:S,onError:y}}}),ve={ref:"canvasRef"};function be(e,t,a,n,s,u){const o=z("FSLoader");return E(),H(ee,P({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,src:e.realSource,style:e.style,onError:e.onError},e.$attrs),{placeholder:V(()=>[e.$props.imageId?(E(),H(o,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])):L("",!0)]),error:V(()=>[e.blurHash?L("",!0):(E(),H(o,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),J("canvas",ve,null,512)]),_:1},16,["height","width","cover","src","style","onError"])}const Fe=Z(D,[["render",be]]);D.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"source",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{Fe as F};
