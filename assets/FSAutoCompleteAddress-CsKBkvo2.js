import{d as V,b as F,c as C,B as I,m as $,I as k,J as L}from"./vue.esm-bundler-PONd4AmC.js";import{_ as v}from"./lodash-Zo30T2Bj.js";import{A as b}from"./address-CE2z3AEI.js";import{u as q}from"./useAppLanguageCode-fPbUdbod.js";import{F as O}from"./FSAutocompleteField-DcUdpD-9.js";import{u as T}from"./useAutocomplete-DsvrErHM.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B=()=>{const{languageCode:r}=q();let d=!1,f,g,c,i;const u=async()=>{await window.initMap,f=await y(),g=new google.maps.places.AutocompleteService,c=new google.maps.places.PlacesService(document.createElement("div")),i=new google.maps.places.AutocompleteSessionToken,d=!0},m=async s=>(d||await u(),(await e(s)).map(t=>({id:t.place_id,label:t.description}))),p=async s=>{var t,n;d||await u();const o=await h(s.id);if(i=new google.maps.places.AutocompleteSessionToken,o.address_components&&o.formatted_address&&o.geometry)return new b({formattedAddress:o.formatted_address,locality:_(o.address_components,"locality"),country:_(o.address_components,"country"),latitude:((t=o.geometry.location)==null?void 0:t.lat())??0,longitude:((n=o.geometry.location)==null?void 0:n.lng())??0,placeId:s.id,placeLabel:s.label});throw new Error("missing informations")},A=async(s,o)=>(d||await u(),w(s,o).then(t=>{var n,l;if(t.length>0){const a=t[0];if(a.address_components&&a.formatted_address&&a.geometry)return new b({formattedAddress:a.formatted_address,locality:_(a.address_components,"locality"),country:_(a.address_components,"country"),latitude:((n=a.geometry.location)==null?void 0:n.lat())??0,longitude:((l=a.geometry.location)==null?void 0:l.lng())??0,placeId:a.place_id,placeLabel:a.formatted_address})}throw new Error("missing informations")})),y=async()=>navigator.geolocation?new Promise(s=>{navigator.geolocation.getCurrentPosition(o=>{s({lat:o.coords.latitude,lng:o.coords.longitude})},()=>s(null))}):null,e=s=>new Promise((o,t)=>{var l;const n=(l=r.value)==null?void 0:l.split("-")[0];g.getPlacePredictions({input:s,region:n,language:n,sessionToken:i,locationBias:f},function(a,S){S!=google.maps.places.PlacesServiceStatus.OK||!a?t(S):o(a)})}),w=(s,o)=>new Promise((t,n)=>{new google.maps.Geocoder().geocode({location:{lat:s,lng:o}},(l,a)=>{a!=google.maps.GeocoderStatus.OK||!l?n(a):t(l)})}),h=s=>new Promise((o,t)=>{c.getDetails({placeId:s,sessionToken:i,fields:["formatted_address","geometry","address_components","name"]},(n,l)=>{l!=google.maps.places.PlacesServiceStatus.OK||!n?t(l):o(n)})}),_=(s,o)=>{const t=v.find(s,n=>v.some(n.types,l=>l===o));return(t==null?void 0:t.long_name)??""};return{search:m,get:p,reverseSearch:A}},P=V({name:"FSAutocompleteAddress",components:{FSAutocompleteField:O},props:{modelValue:{type:Object,required:!1,default:null},label:{type:String,required:!1,default:null}},emits:["update:modelValue"],setup(r,{emit:d}){const{search:f,get:g}=B(),c=F([]),i=C(()=>{if(r.modelValue){const e=y(r.modelValue),w=c.value.filter(h=>h.id!==e.id);return[e,...w]}return c.value}),u=async e=>e===null?Promise.resolve([]):(c.value=await f(e),Promise.resolve([])),m=async e=>{if(e===null){d("update:modelValue",null);return}Array.isArray(e)&&(e=e[0]);const w=await g(e);d("update:modelValue",w)},{search:p,onUpdate:A}=T(c,[],d,u,m,e=>e.id,e=>e.label,!0,!1,0,500),y=e=>({id:e.placeId,label:e.placeLabel});return{places:c,items:i,search:p,onUpdate:A}}});function E(r,d,f,g,c,i){var m;const u=k("FSAutocompleteField");return L(),I(u,$({label:r.$props.label??r.$tr("ui.common.address","Address"),clearable:!1,toggleSet:!1,multiple:!1,items:r.items,customFilter:(p,A,y)=>{var e;return y.value!==((e=r.$props.modelValue)==null?void 0:e.placeId)},modelValue:(m=r.$props.modelValue)==null?void 0:m.placeId,"onUpdate:modelValue":r.onUpdate,search:r.search,"onUpdate:search":d[0]||(d[0]=p=>r.search=p)},r.$attrs),null,16,["label","items","customFilter","modelValue","onUpdate:modelValue","search"])}const J=U(P,[["render",E]]);P.__docgenInfo={displayName:"FSAutocompleteAddress",exportName:"default",description:"",tags:{},props:[{name:"modelValue",type:{name:"Object as () => Address | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"label",type:{name:"string"},required:!1,defaultValue:{func:!1,value:"null"}}],events:[{name:"update:modelValue"}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/autocompletes/FSAutoCompleteAddress.vue"]};export{J as F,B as u};
