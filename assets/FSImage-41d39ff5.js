import{j as G,d as B,e as c,w as W,H as T,I as F,J as H,K as N,x as D,z as x,M as O,W as j}from"./vue.esm-bundler-43a473fd.js";import{F as k}from"./FSLoader-75274e0e.js";import{a as z}from"./base-0de1729e.js";import{S as P}from"./serviceFactory-3393b4e4.js";import{C as J}from"./composableFactory-cfaf9e24.js";import{s as h,v as V}from"./css-18b0cf8e.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{V as X}from"./VImg-ded4a17b.js";class Y{constructor(a){this.blurHash=a.blurHash,this.width=a.width,this.height=a.height}}const E=()=>`${z()}/images`,Q=()=>`${E()}/raw`,Z=e=>`${Q()}/${encodeURIComponent(e)}`,ee=()=>`${E()}/blurHash`,ae=e=>`${ee()}/${encodeURIComponent(e)}`,te={...P.addCustom("getBlurHash",(e,a)=>e.get(ae(a)),e=>new Y(e))},re=J.custom(te.getBlurHash);var le=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],v=e=>{let a=0;for(let t=0;t<e.length;t++){let l=e[t],s=le.indexOf(l);a=a*83+s}return a},$=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},M=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},ie=e=>e<0?-1:1,S=(e,a)=>ie(e)*Math.pow(Math.abs(e),a),_=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},q=e=>{if(!e||e.length<6)throw new _("The blurhash string must be at least 6 characters");let a=v(e[0]),t=Math.floor(a/9)+1,l=a%9+1;if(e.length!==4+2*l*t)throw new _(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*l*t}`)},ne=e=>{try{q(e)}catch(a){return{result:!1,errorReason:a.message}}return{result:!0}},se=e=>{let a=e>>16,t=e>>8&255,l=e&255;return[$(a),$(t),$(l)]},ue=(e,a)=>{let t=Math.floor(e/361),l=Math.floor(e/19)%19,s=e%19;return[S((t-9)/9,2)*a,S((l-9)/9,2)*a,S((s-9)/9,2)*a]},oe=(e,a,t,l)=>{q(e),l=l|1;let s=v(e[0]),f=Math.floor(s/9)+1,u=s%9+1,y=(v(e[1])+1)/166,m=new Array(u*f);for(let i=0;i<m.length;i++)if(i===0){let n=v(e.substring(2,6));m[i]=se(n)}else{let n=v(e.substring(4+i*2,6+i*2));m[i]=ue(n,y*l)}let d=a*4,o=new Uint8ClampedArray(d*t);for(let i=0;i<t;i++)for(let n=0;n<a;n++){let r=0,b=0,g=0;for(let R=0;R<f;R++)for(let p=0;p<u;p++){let w=Math.cos(Math.PI*n*p/a)*Math.cos(Math.PI*i*R/t),I=m[p+R*u];r+=I[0]*w,b+=I[1]*w,g+=I[2]*w}let C=M(r),L=M(b),U=M(g);o[4*n+0+i*d]=C,o[4*n+1+i*d]=L,o[4*n+2+i*d]=U,o[4*n+3+i*d]=255}return o},de=oe;const A=G({name:"FSImage",components:{FSLoader:k},props:{height:{type:[Array,String,Number],required:!1,default:null},width:{type:[Array,String,Number],required:!1,default:null},imageId:{type:String,required:!1,default:null},imageB64:{type:String,required:!1,default:null},aspectRatio:{type:String,required:!1,default:null},borderRadius:{type:[String,Number],required:!1,default:"4px"},cover:{type:Boolean,required:!1,default:!0}},setup(e){const{fetch:a,entity:t}=re(),l=B(null),s=B(null),f=B({JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"}),u=c(()=>({"--fs-image-border-radius":h(e.borderRadius),"--fs-image-blurhash-opacity":t.value?"1":"0"})),y=c(()=>{if(e.height)return h(e.height);if(e.width){if(typeof e.width=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return h(V(e.width)*(parseFloat(r[1])/parseFloat(r[0])))}return h(e.width)}}),m=c(()=>{if(e.width)return h(e.width);if(e.height){if(typeof e.height=="string")return;if(e.aspectRatio){const r=e.aspectRatio.split("/");if(r.length===2&&!isNaN(parseFloat(r[0]))&&!isNaN(parseFloat(r[1])))return h(V(e.height)*(parseFloat(r[0])/parseFloat(r[1])))}return h(e.height)}}),d=c(()=>{if(e.imageId)return Z(e.imageId);if(e.imageB64&&i.value&&o.value)return`${i.value},${o.value}`}),o=c(()=>e.imageB64&&e.imageB64.includes(",")?e.imageB64.split(",")[1]:e.imageB64),i=c(()=>{if(e.imageB64&&e.imageB64.includes(","))return e.imageB64.split(",")[0];if(e.imageB64){for(const r in f.value)if(e.imageB64.startsWith(r))return`data:${f.value[r]};base64`}return null}),n=()=>{e.imageId&&a(e.imageId)};return W(()=>t.value,()=>{if(s.value&&l.value&&t.value&&ne(t.value.blurHash).result){const r=s.value.getContext("2d");if(r){const b=de(t.value.blurHash,l.value.$el.clientWidth,l.value.$el.clientHeight),g=r.createImageData(l.value.$el.clientWidth,l.value.$el.clientHeight);g.data.set(b),r.putImageData(g,0,0)}}}),{computedHeight:y,computedWidth:m,canvasRef:s,imageRef:l,blurHash:t,source:d,style:u,onError:n}}}),he={ref:"canvasRef"};function fe(e,a,t,l,s,f){const u=T("FSLoader");return F(),H(X,D({class:"fs-image",ref:"imageRef",height:e.computedHeight,width:e.computedWidth,cover:e.$props.cover,style:e.style,src:e.source,onError:e.onError},e.$attrs),{placeholder:N(()=>[x(u,{class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])]),error:N(()=>[e.blurHash?O("",!0):(F(),H(u,{key:0,class:"fs-image-load",height:"100%",width:"100%",borderRadius:e.$props.borderRadius},null,8,["borderRadius"])),j("canvas",he,null,512)]),_:1},16,["height","width","cover","style","src","onError"])}const we=K(A,[["render",fe]]);A.__docgenInfo={displayName:"FSImage",exportName:"default",description:"",tags:{},props:[{name:"height",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"width",type:{name:"string[] | number[] | string | number | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageId",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"imageB64",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"aspectRatio",type:{name:"string | null"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"borderRadius",type:{name:"string|number"},required:!1,defaultValue:{func:!1,value:'"4px"'}},{name:"cover",type:{name:"boolean"},required:!1,defaultValue:{func:!1,value:"true"}}],sourceFiles:["/home/runner/work/foundation-shared-ui/foundation-shared-ui/src/shared/foundation-shared-components/components/FSImage.vue"]};export{we as F};
